<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sight Word Matcher: Level Progression</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;700&display=swap');
        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #f0f4f8;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        .game-card {
            background-color: #ffffff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 100%;
            padding: 2rem;
            text-align: center;
        }
        /* Increased spacing after the title */
        .game-title {
            margin-bottom: 2.5rem; 
        }
        .score-display {
            font-size: 1.25rem;
            font-weight: 700;
            color: #10b981;
            margin-bottom: 0.5rem;
        }
        .word-container {
            min-height: 80px;
            font-size: 3rem;
            font-weight: 700;
            color: #334155;
            /* Increased bottom margin for more separation */
            margin-bottom: 3rem; 
            display: flex;
            justify-content: center;
            align-items: flex-end;
        }
        .image-box {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 150px;
            font-size: 8rem;
            margin-bottom: 1.5rem;
            border-radius: 10px;
            background-color: #e2e8f0;
        }
        .word-button {
            transition: all 0.1s ease;
            cursor: pointer;
            user-select: none;
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            font-size: 2rem;
            font-weight: 700;
            margin: 5px;
            min-width: 120px;
        }
        .word-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(74, 144, 226, 0.3);
        }
        .correct-answer-button {
            background-color: #4ade80 !important;
            border-color: #16a34a !important;
            color: white !important;
        }
        .incorrect-answer-button {
            background-color: #f87171 !important;
            border-color: #dc2626 !important;
            color: white !important;
        }
        .level-indicator { /* Renamed for clarity, removed difficulty style */
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 700;
            display: inline-block;
            margin-bottom: 0.5rem; /* Space below level indicator */
        }
        /* --- PROGRESS BAR STYLES (Unchanged) --- */
        .progress-bar-container {
            width: 80%;
            margin: 0 auto 1.5rem;
            height: 20px;
            background-color: #e0e7ff;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        #progressBar {
            height: 100%;
            width: 0%;
            background-color: #8b5cf6;
            transition: width 0.5s ease-in-out;
            border-radius: 10px 0 0 10px;
        }
        /* --- SOLID LINE ALIGNMENT FIX --- */
        #sentenceDisplay .blank-slot {
            display: inline-block;
            width: 100px;
            border-bottom: 4px solid #334155; 
            margin: 0 5px;
            padding-bottom: 5px; 
            margin-bottom: -5px; 
        }
    </style>
</head>
<body>
    <div class="game-card">
        <h1 class="text-3xl font-bold text-gray-800 game-title">Find the Sight Word!</h1>
        
        <div class="flex justify-center items-center">
            <span id="levelIndicator" class="level-indicator bg-indigo-200 text-indigo-700">LEVEL 1</span>
        </div>
        
        <div id="scoreDisplay" class="score-display">Progress: 0 / 10</div>

        <div class="progress-bar-container">
            <div id="progressBar"></div>
        </div>

        <div id="imageBox" class="image-box text-center">
        </div>

        <div id="sentenceDisplay" class="word-container italic">
        </div>

        <div id="mx-auto flex justify-center">
            <div id="wordButtons" class="flex justify-center gap-4 flex-wrap max-w-lg">
            </div>
        </div>

        <p id="feedback" class="text-xl h-6 font-semibold mt-6 text-gray-600"></p>
    </div>

    <script>
        // --- Game Data: Structured Levels (10 words each) ---
        const gameLevels = [
            // Level 1: Kindergarten (Dolch Pre-Primer/Primer Focus) - 10 Words
            {
                name: "Level 1: Beginner",
                words: [
                    { word: "THE", sentence: "Look at ____ sun!", emoji: "‚òÄÔ∏è" },
                    { word: "IS", sentence: "The bug ____ small.", emoji: "üêõ" },
                    { word: "AND", sentence: "I like dogs ____ cats.", emoji: "üêïüêà" },
                    { word: "A", sentence: "I see ____ little house.", emoji: "üè†" },
                    { word: "TO", sentence: "We go ____ the park.", emoji: "üå≥" },
                    { word: "IN", sentence: "The fish is ____ the water.", emoji: "üíß" },
                    { word: "IT", sentence: "____ is my turn now.", emoji: "üôã" },
                    { word: "OF", sentence: "A box ____ toys.", emoji: "üéÅ" },
                    { word: "WAS", sentence: "She ____ running fast.", emoji: "üèÉ‚Äç‚ôÄÔ∏è" },
                    { word: "FOR", sentence: "This gift is ____ you.", emoji: "üéÅ" }
                ]
            },
            // Level 2: First Grade (Dolch Primer/Grade 1 Focus) - 10 Words
            {
                name: "Level 2: Intermediate",
                words: [
                    { word: "HAVE", sentence: "I ____ a new friend.", emoji: "ü§ù" },
                    { word: "FROM", sentence: "The letter is ____ Mom.", emoji: "‚úâÔ∏è" },
                    { word: "BUT", sentence: "I want a cookie, ____ I can't.", emoji: "üç™" },
                    { word: "NOT", sentence: "The ball is ____ red.", emoji: "üèà" },
                    { word: "ALL", sentence: "We ate ____ the food.", emoji: "üçï" },
                    { word: "WERE", sentence: "They ____ happy to play.", emoji: "üòä" },
                    { word: "WHEN", sentence: "____ will we go home?", emoji: "üè°" },
                    { word: "ARE", sentence: "You ____ a good helper.", emoji: "üëç" },
                    { word: "SAID", sentence: "She ____ 'Hello'.", emoji: "üó£Ô∏è" },
                    { word: "LIKE", sentence: "I ____ to read books.", emoji: "üìö" }
                ]
            },
            // Level 3: Second Grade (Dolch Grade 2 Focus) - 10 Words
            {
                name: "Level 3: Advanced",
                words: [
                    { word: "ALWAYS", sentence: "He ____ wears a hat.", emoji: "üé©" },
                    { word: "BOTH", sentence: "____ my shoes are new.", emoji: "üëü" },
                    { word: "FAST", sentence: "The car goes very ____.", emoji: "üöó" },
                    { word: "READ", sentence: "Can you ____ this story?", emoji: "üìñ" },
                    { word: "YOUR", sentence: "Is this ____ coat?", emoji: "üß•" },
                    { word: "BEFORE", sentence: "Wash hands ____ eating.", emoji: "üßº" },
                    { word: "BETTER", sentence: "This way is ____.", emoji: "‚úÖ" },
                    { word: "CALL", sentence: "Please ____ me later.", emoji: "üìû" },
                    { word: "SIT", sentence: "Please ____ down here.", emoji: "ü™ë" },
                    { word: "TELL", sentence: "____ me a secret!", emoji: "ü§´" }
                ]
            }
        ];

        // --- Audio & Speech Setup (Unchanged) ---
        const correctSynth = new Tone.Synth({
            oscillator: { type: "sine" }, envelope: { attack: 0.005, decay: 0.1, sustain: 0.05, release: 0.1 }
        }).toDestination();
        const incorrectSynth = new Tone.Synth({
            oscillator: { type: "square" }, envelope: { attack: 0.01, decay: 0.05, sustain: 0.01, release: 0.1 }
        }).toDestination();
        const speech = new SpeechSynthesisUtterance();
        speech.lang = 'en-US'; 
        speech.rate = 0.8;      

        // --- Game State Variables ---
        let currentLevelIndex = 0;              
        let masteredWords = new Set();          
        let currentWordData = {};
        let correctStreak = 0;                  
        const DIFFICULTY_THRESHOLD = 5;

        // DOM Elements
        const imageBox = document.getElementById('imageBox');
        const sentenceDisplayEl = document.getElementById('sentenceDisplay');
        const wordButtonsContainer = document.getElementById('wordButtons');
        const feedbackEl = document.getElementById('feedback');
        const scoreDisplayEl = document.getElementById('scoreDisplay');
        const levelIndicatorEl = document.getElementById('levelIndicator');
        const progressBarEl = document.getElementById('progressBar'); 

        // --- UTILITY FUNCTIONS ---
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        function playCorrectSound() {
            const now = Tone.now();
            correctSynth.triggerAttackRelease("C5", "16n", now);
            correctSynth.triggerAttackRelease("E5", "16n", now + 0.1); 
            correctSynth.triggerAttackRelease("G5", "8n", now + 0.2); 
        }

        function playIncorrectSound() {
            incorrectSynth.triggerAttackRelease("C3", "16n");
        }

        function speakText(text) {
            window.speechSynthesis.cancel();
            speech.text = text;
            window.speechSynthesis.speak(speech);
        }

        function setFemaleVoice() {
            const voices = window.speechSynthesis.getVoices();
            const femaleVoice = voices.find(voice => 
                voice.lang === 'en-US' && 
                (voice.name.includes('Female') || voice.name.includes('Zira') || voice.name.includes('Samantha'))
            );
            if (femaleVoice) {
                speech.voice = femaleVoice;
            }
        }
        if (window.speechSynthesis.onvoiceschanged !== undefined) {
            window.speechSynthesis.onvoiceschanged = setFemaleVoice;
        } else {
            setFemaleVoice();
        }

        // --- LEVEL MANAGEMENT FUNCTIONS ---

        function updateGameStatus() {
            const totalWords = gameLevels[currentLevelIndex].words.length;
            const progress = masteredWords.size;
            
            // 1. Update Score/Progress Text
            scoreDisplayEl.textContent = `Progress: ${progress} / ${totalWords}`;
            
            // 2. Update Progress Bar (Visual Achievement)
            const percentage = (progress / totalWords) * 100;
            progressBarEl.style.width = `${percentage}%`;
            
            // 3. Update Level Indicator (Current Level)
            levelIndicatorEl.textContent = gameLevels[currentLevelIndex].name.toUpperCase();
            
            // 4. NOTE: Difficulty indicator removed entirely.
        }
        
        function loadNextLevel() {
            currentLevelIndex++;
            masteredWords.clear();
            
            if (currentLevelIndex >= gameLevels.length) {
                // Game Over / All Levels Complete
                feedbackEl.textContent = "CONGRATULATIONS! You mastered all levels! üéâ";
                speakText("Congratulations! You mastered all three levels!");
                wordButtonsContainer.innerHTML = '';
                imageBox.textContent = 'üèÜ';
                sentenceDisplayEl.innerHTML = '<span class="text-2xl">Game Complete!</span>';
                return;
            }
            
            // Announce the new level
            const newLevelName = gameLevels[currentLevelIndex].name;
            feedbackEl.textContent = `LEVEL UP! Starting ${newLevelName}! üöÄ`;
            speakText(`Level up! Starting ${newLevelName}!`);
            
            correctStreak = 0;
            setTimeout(loadNewProblem, 3000); 
        }

        // Function to select a random word *not yet mastered* in the current level
        function loadNewProblem() {
            if (currentLevelIndex >= gameLevels.length) return; 

            const currentLevelWords = gameLevels[currentLevelIndex].words;
            const unmasteredWords = currentLevelWords.filter(w => !masteredWords.has(w.word));

            if (unmasteredWords.length === 0) {
                loadNextLevel();
                return; 
            }
            
            shuffleArray(unmasteredWords);
            
            const availableForSelection = unmasteredWords.filter(w => w.word !== currentWordData.word);
            currentWordData = availableForSelection[0] || unmasteredWords[0];
            
            feedbackEl.textContent = '';
            updateGameStatus();

            // Update display: Replace '____' with the styled solid line slot
            imageBox.textContent = currentWordData.emoji;
            const sentenceWithSlot = currentWordData.sentence.replace('____', '<span class="blank-slot"></span>');
            sentenceDisplayEl.innerHTML = sentenceWithSlot;

            // Update speech
            const speechText = currentWordData.sentence.replace('____', '... blank ...');
            speakText(speechText);

            generateWordButtons(currentWordData.word);
        }

        // Function to create the set of clickable word buttons (Distractor logic remains the same)
        function generateWordButtons(targetWord) {
            wordButtonsContainer.innerHTML = '';
            
            const currentLevelWords = gameLevels[currentLevelIndex].words;
            // Dynamic difficulty logic remains: 3 choices if streak < 5, 5 choices if streak >= 5
            const numChoices = (correctStreak >= DIFFICULTY_THRESHOLD) ? 5 : 3; 
            
            const distractors = currentLevelWords
                .map(w => w.word)
                .filter(word => word !== targetWord);
            
            shuffleArray(distractors);

            const buttonWords = [targetWord, ...distractors.slice(0, numChoices - 1)];
            
            shuffleArray(buttonWords); 

            buttonWords.forEach(word => {
                const button = document.createElement('button');
                button.textContent = word;
                button.classList.add('word-button', 'bg-purple-400', 'text-white', 'shadow-md');
                button.addEventListener('click', () => handleWordClick(word, button));
                wordButtonsContainer.appendChild(button);
            });
        }

        // --- EVENT HANDLER (Unchanged) ---

        function handleWordClick(clickedWord, buttonElement) {
            if (Tone.context.state !== 'running') {
                Tone.start();
            }
            
            window.speechSynthesis.cancel();
            Array.from(wordButtonsContainer.children).forEach(btn => btn.disabled = true);

            if (clickedWord === currentWordData.word) {
                // Correct Answer
                buttonElement.classList.add('correct-answer-button');
                playCorrectSound();
                
                masteredWords.add(currentWordData.word); 

                feedbackEl.textContent = "YES! " + currentWordData.word + " fits!";
                correctStreak++;

                // Update display to show the word filled in (removing the solid line slot)
                const completedSentence = currentWordData.sentence.replace('____', currentWordData.word);
                sentenceDisplayEl.innerHTML = completedSentence;

                // Speak the completed sentence
                speakText(currentWordData.word + ". " + completedSentence);

                setTimeout(loadNewProblem, 3000);

            } else {
                // Incorrect Answer
                playIncorrectSound();
                feedbackEl.textContent = "Not quite! Try another word.";
                buttonElement.classList.add('incorrect-answer-button');
                
                correctStreak = 0; 
                updateGameStatus();

                setTimeout(() => {
                    buttonElement.classList.remove('incorrect-answer-button');
                    feedbackEl.textContent = '';
                    Array.from(wordButtonsContainer.children).forEach(btn => {
                        if (btn !== buttonElement) {
                             btn.disabled = false;
                        } else {
                             btn.style.opacity = '0.5';
                        }
                    });
                    
                    // Re-speak the sentence prompt and re-display the blank slot
                    const speechText = currentWordData.sentence.replace('____', '... blank ...');
                    speakText(speechText);
                    const sentenceWithSlot = currentWordData.sentence.replace('____', '<span class="blank-slot"></span>');
                    sentenceDisplayEl.innerHTML = sentenceWithSlot;

                }, 1000);
            }
        }

        // --- INITIALIZATION ---
        window.onload = loadNewProblem;

    </script>
</body>
</html>
