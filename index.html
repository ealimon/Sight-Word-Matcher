<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>First Grade Sight Word Matcher (with Audio)</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* CSS styles remain the same for visual consistency */
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;700&display=swap');
        body {
            font-family: 'Fredoka', sans-serif;
            background-color: #f0f4f8;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }
        .game-card {
            background-color: #ffffff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            max-width: 600px;
            width: 100%;
            padding: 2rem;
            text-align: center;
        }
        .score-display {
            font-size: 1.25rem;
            font-weight: 700;
            color: #10b981;
            margin-bottom: 1rem;
        }
        .word-container {
            min-height: 80px;
            font-size: 3rem;
            font-weight: 700;
            color: #334155;
            margin-bottom: 2rem;
        }
        .image-box {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 150px;
            font-size: 8rem;
            margin-bottom: 1.5rem;
            border-radius: 10px;
            background-color: #e2e8f0;
        }
        .word-button {
            transition: all 0.1s ease;
            cursor: pointer;
            user-select: none;
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            font-size: 2rem;
            font-weight: 700;
            margin: 5px;
            min-width: 120px;
        }
        .word-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(74, 144, 226, 0.3);
        }
        .correct-answer-button {
            background-color: #4ade80 !important;
            border-color: #16a34a !important;
            color: white !important;
        }
        .incorrect-answer-button {
            background-color: #f87171 !important;
            border-color: #dc2626 !important;
            color: white !important;
        }
        .difficulty-indicator {
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 700;
            margin-top: -1rem;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="game-card">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">Find the Sight Word!</h1>
        
        <span id="difficultyIndicator" class="difficulty-indicator bg-blue-200 text-blue-700">FEW CHOICES</span>
        
        <div id="scoreDisplay" class="score-display">Correct Streak: 0</div>

        <div id="imageBox" class="image-box text-center">
        </div>

        <div id="sentenceDisplay" class="word-container flex justify-center mb-8 italic">
        </div>

        <div id="mx-auto flex justify-center">
            <div id="wordButtons" class="flex justify-center gap-4 flex-wrap max-w-lg">
            </div>
        </div>

        <p id="feedback" class="text-xl h-6 font-semibold mt-6 text-gray-600"></p>
    </div>

    <script>
        // --- Game Data: Common Sight Words with sentence context ---
        const sightWords = [
            { word: "THE", sentence: "Look at ____ sun!", emoji: "â˜€ï¸" },
            { word: "IS", sentence: "The bug ____ small.", emoji: "ðŸ›" },
            { word: "AND", sentence: "I like dogs ____ cats.", emoji: "ðŸ•ðŸˆ" },
            { word: "A", sentence: "I see ____ little house.", emoji: "ðŸ " },
            { word: "TO", sentence: "We go ____ the park.", emoji: "ðŸŒ³" },
            { word: "IN", sentence: "The fish is ____ the water.", emoji: "ðŸ’§" },
            { word: "IT", sentence: "____ is my turn now.", emoji: "ðŸ™‹" },
            { word: "OF", sentence: "A box ____ toys.", emoji: "ðŸŽ" },
            { word: "WAS", sentence: "She ____ running fast.", emoji: "ðŸƒâ€â™€ï¸" },
            { word: "FOR", sentence: "This gift is ____ you.", emoji: "ðŸŽ" }
        ];

        // --- Audio & Speech Setup ---
        const correctSynth = new Tone.Synth({
            oscillator: { type: "sine" },
            envelope: { attack: 0.005, decay: 0.1, sustain: 0.05, release: 0.1 }
        }).toDestination();
        const incorrectSynth = new Tone.Synth({
            oscillator: { type: "square" },
            envelope: { attack: 0.01, decay: 0.05, sustain: 0.01, release: 0.1 }
        }).toDestination();

        // Web Speech API setup
        const speech = new SpeechSynthesisUtterance();
        speech.lang = 'en-US'; // Set language for clear reading
        speech.rate = 0.8;      // Slightly slower speech for children

        // --- Game State Variables ---
        let currentWordData = {};
        let correctStreak = 0;
        const DIFFICULTY_THRESHOLD = 5;

        const imageBox = document.getElementById('imageBox');
        const sentenceDisplayEl = document.getElementById('sentenceDisplay');
        const wordButtonsContainer = document.getElementById('wordButtons');
        const feedbackEl = document.getElementById('feedback');
        const scoreDisplayEl = document.getElementById('scoreDisplay');
        const difficultyIndicatorEl = document.getElementById('difficultyIndicator');

        // --- UTILITY FUNCTIONS ---
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        
        function playCorrectSound() {
            const now = Tone.now();
            correctSynth.triggerAttackRelease("C5", "16n", now);
            correctSynth.triggerAttackRelease("E5", "16n", now + 0.1); 
            correctSynth.triggerAttackRelease("G5", "8n", now + 0.2); 
        }

        function playIncorrectSound() {
            incorrectSynth.triggerAttackRelease("C3", "16n");
        }

        // New function to speak text
        function speakText(text) {
            window.speechSynthesis.cancel(); // Stop any current speech
            speech.text = text;
            window.speechSynthesis.speak(speech);
        }

        function updateGameStatus() {
            scoreDisplayEl.textContent = `Correct Streak: ${correctStreak}`;
            
            if (correctStreak >= DIFFICULTY_THRESHOLD) {
                difficultyIndicatorEl.textContent = "MORE CHOICES";
                difficultyIndicatorEl.classList.remove('bg-blue-200', 'text-blue-700');
                difficultyIndicatorEl.classList.add('bg-red-200', 'text-red-700');
            } else {
                difficultyIndicatorEl.textContent = "FEW CHOICES";
                difficultyIndicatorEl.classList.add('bg-blue-200', 'text-blue-700');
                difficultyIndicatorEl.classList.remove('bg-red-200', 'text-red-700');
            }
        }

        function loadNewProblem() {
            const availableWords = sightWords.filter(w => w.word !== currentWordData.word);
            shuffleArray(availableWords);
            
            currentWordData = availableWords[0] || sightWords[0];
            
            feedbackEl.textContent = '';
            updateGameStatus();

            // Update image display and sentence context
            imageBox.textContent = currentWordData.emoji;
            sentenceDisplayEl.textContent = currentWordData.sentence;

            // NEW: Speak the sentence prompt
            // Replace the blank ('____') with a pause or 'blank' for better reading flow
            const speechText = currentWordData.sentence.replace('____', '... blank ...');
            speakText(speechText);

            // Generate word button choices
            generateWordButtons(currentWordData.word);
        }

        function generateWordButtons(targetWord) {
            wordButtonsContainer.innerHTML = '';
            
            const numChoices = (correctStreak >= DIFFICULTY_THRESHOLD) ? 5 : 3; 
            
            const distractors = sightWords
                .map(w => w.word)
                .filter(word => word !== targetWord);
            
            shuffleArray(distractors);

            const buttonWords = [targetWord, ...distractors.slice(0, numChoices - 1)];
            
            shuffleArray(buttonWords); 

            buttonWords.forEach(word => {
                const button = document.createElement('button');
                button.textContent = word;
                button.classList.add('word-button', 'bg-purple-400', 'text-white', 'shadow-md');
                button.addEventListener('click', () => handleWordClick(word, button));
                wordButtonsContainer.appendChild(button);
            });
        }

        // --- EVENT HANDLER ---

        function handleWordClick(clickedWord, buttonElement) {
            if (Tone.context.state !== 'running') {
                Tone.start();
            }
            
            window.speechSynthesis.cancel(); // Stop sentence reading when player clicks
            Array.from(wordButtonsContainer.children).forEach(btn => btn.disabled = true);

            if (clickedWord === currentWordData.word) {
                // Correct Answer
                buttonElement.classList.add('correct-answer-button');
                playCorrectSound();
                feedbackEl.textContent = "YES! " + currentWordData.word + " fits!";
                correctStreak++;

                // NEW: Speak the correct word and the complete sentence
                const completedSentence = currentWordData.sentence.replace('____', currentWordData.word);
                speakText(currentWordData.word + ". " + completedSentence);


                // Automatically load the next problem after audio finishes (or a slight delay)
                setTimeout(loadNewProblem, 3000);

            } else {
                // Incorrect Answer
                playIncorrectSound();
                feedbackEl.textContent = "Not quite! Try another word.";
                buttonElement.classList.add('incorrect-answer-button');
                
                correctStreak = 0; 
                updateGameStatus();

                setTimeout(() => {
                    buttonElement.classList.remove('incorrect-answer-button');
                    feedbackEl.textContent = '';
                    Array.from(wordButtonsContainer.children).forEach(btn => {
                        if (btn !== buttonElement) {
                             btn.disabled = false;
                        } else {
                             btn.style.opacity = '0.5';
                        }
                    });

                }, 1000);
            }
        }

        // --- INITIALIZATION ---
        window.onload = loadNewProblem;

    </script>
</body>
</html>
